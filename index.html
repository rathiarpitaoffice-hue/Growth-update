<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’ª Goal Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’ª</text></svg>">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Track your habits, tasks, and progress goals with Google Sheets sync">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Goal Tracker">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’ª</text></svg>">
    <link rel="manifest" href="manifest.json">
    
    <!-- Google APIs -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Google API Configuration
        const CLIENT_ID = '963748755946-tv2sehm5eiatm1eqbh9akkftu25es8mn.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        
        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        
        // Icons
        const Calendar = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const Check = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const Target = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>;
        const TrendingUp = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>;
        const Plus = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Trash2 = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const Edit2 = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>;
        const X = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const ChevronLeft = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 18 9 12 15 6"></polyline></svg>;
        const ChevronRight = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const Cloud = ({size=24,className=''}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>;

        const GoalTrackerApp = () => {
          const [habits, setHabits] = useState([]);
          const [tasks, setTasks] = useState([]);
          const [progress, setProgress] = useState([]);
          const [activeTab, setActiveTab] = useState('dashboard');
          const [currentMonth, setCurrentMonth] = useState(new Date());
          const [isLoading, setIsLoading] = useState(true);
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [spreadsheetId, setSpreadsheetId] = useState(null);
          const [syncStatus, setSyncStatus] = useState('disconnected');

          const [showAddModal, setShowAddModal] = useState(false);
          const [showEditModal, setShowEditModal] = useState(false);
          const [modalType, setModalType] = useState('habit');
          const [editingGoal, setEditingGoal] = useState(null);

          const [formData, setFormData] = useState({
            name: '',
            description: '',
            current: 0,
            target: 100,
            unit: ''
          });

          // Initialize Google APIs
          useEffect(() => {
            initializeGoogleAPIs();
          }, []);

          const initializeGoogleAPIs = async () => {
            // Initialize gapi
            if (typeof gapi !== 'undefined') {
              gapi.load('client', async () => {
                await gapi.client.init({
                  discoveryDocs: [DISCOVERY_DOC],
                });
                gapiInited = true;
                maybeEnableApp();
              });
            }

            // Initialize GIS
            if (typeof google !== 'undefined') {
              tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: async (response) => {
                  if (response.error) {
                    console.error('Auth error:', response);
                    return;
                  }
                  
                  setIsAuthenticated(true);
                  setSyncStatus('connected');
                  localStorage.setItem('goalTracker_token', JSON.stringify(gapi.client.getToken()));
                  
                  await setupSpreadsheet();
                  await loadFromSheets();
                  setIsLoading(false);
                },
              });
              gisInited = true;
              maybeEnableApp();
            }
          };

          const maybeEnableApp = () => {
            if (gapiInited && gisInited) {
              // Check for saved token
              const savedToken = localStorage.getItem('goalTracker_token');
              if (savedToken) {
                try {
                  const tokenObj = JSON.parse(savedToken);
                  gapi.client.setToken(tokenObj);
                  setIsAuthenticated(true);
                  setSyncStatus('connected');
                  
                  // Load data
                  setupSpreadsheet().then(() => {
                    loadFromSheets();
                    setIsLoading(false);
                  });
                } catch (e) {
                  console.error('Token restore error:', e);
                  loadFromLocalStorage();
                  setIsLoading(false);
                }
              } else {
                loadFromLocalStorage();
                setIsLoading(false);
              }
            }
          };

          const handleAuthClick = () => {
            if (!tokenClient) {
              alert('Google Sign-In not ready yet. Please refresh the page.');
              return;
            }
            tokenClient.requestAccessToken({ prompt: 'consent' });
          };

          const setupSpreadsheet = async () => {
            try {
              // Check if we have a saved spreadsheet ID
              const savedId = localStorage.getItem('goalTracker_spreadsheetId');
              
              if (savedId) {
                // Verify it exists
                try {
                  await gapi.client.sheets.spreadsheets.get({
                    spreadsheetId: savedId
                  });
                  setSpreadsheetId(savedId);
                  console.log('Using existing spreadsheet:', savedId);
                  return;
                } catch (e) {
                  console.log('Saved spreadsheet not found, creating new one');
                }
              }

              // Create new spreadsheet
              const response = await gapi.client.sheets.spreadsheets.create({
                properties: {
                  title: 'Goal Tracker - ' + new Date().toLocaleDateString()
                },
                sheets: [
                  { properties: { title: 'Habits' } },
                  { properties: { title: 'Tasks' } },
                  { properties: { title: 'Progress' } }
                ]
              });

              const newId = response.result.spreadsheetId;
              setSpreadsheetId(newId);
              localStorage.setItem('goalTracker_spreadsheetId', newId);

              // Add headers
              await gapi.client.sheets.spreadsheets.values.batchUpdate({
                spreadsheetId: newId,
                resource: {
                  data: [
                    {
                      range: 'Habits!A1:E1',
                      values: [['ID', 'Name', 'Description', 'CompletedDates', 'CreatedAt']]
                    },
                    {
                      range: 'Tasks!A1:E1',
                      values: [['ID', 'Name', 'Description', 'Completed', 'CreatedAt']]
                    },
                    {
                      range: 'Progress!A1:G1',
                      values: [['ID', 'Name', 'Description', 'Current', 'Target', 'Unit', 'CreatedAt']]
                    }
                  ],
                  valueInputOption: 'RAW'
                }
              });

              console.log('Created new spreadsheet:', newId);
            } catch (error) {
              console.error('Error setting up spreadsheet:', error);
            }
          };

          const saveToSheets = async () => {
            if (!spreadsheetId || !isAuthenticated) {
              saveToLocalStorage();
              return;
            }

            try {
              setSyncStatus('syncing');

              // Prepare data rows
              const habitRows = habits.map(h => [
                h.id,
                h.name,
                h.description || '',
                JSON.stringify(h.completedDates),
                h.createdAt
              ]);

              const taskRows = tasks.map(t => [
                t.id,
                t.name,
                t.description || '',
                t.completed ? 'TRUE' : 'FALSE',
                t.createdAt
              ]);

              const progressRows = progress.map(p => [
                p.id,
                p.name,
                p.description || '',
                p.current,
                p.target,
                p.unit || '',
                p.createdAt
              ]);

              // STEP 1: Clear all old data first
              await gapi.client.sheets.spreadsheets.values.batchClear({
                spreadsheetId: spreadsheetId,
                ranges: ['Habits!A2:E1000', 'Tasks!A2:E1000', 'Progress!A2:G1000']
              });

              // STEP 2: Write new data using batchUpdate
              const updateData = [];
              
              if (habitRows.length > 0) {
                updateData.push({
                  range: 'Habits!A2',
                  values: habitRows
                });
              }
              
              if (taskRows.length > 0) {
                updateData.push({
                  range: 'Tasks!A2',
                  values: taskRows
                });
              }
              
              if (progressRows.length > 0) {
                updateData.push({
                  range: 'Progress!A2',
                  values: progressRows
                });
              }

              if (updateData.length > 0) {
                await gapi.client.sheets.spreadsheets.values.batchUpdate({
                  spreadsheetId: spreadsheetId,
                  resource: {
                    data: updateData,
                    valueInputOption: 'RAW'
                  }
                });
              }

              setSyncStatus('connected');
              saveToLocalStorage(); // Backup
            } catch (error) {
              console.error('Error saving to sheets:', error);
              setSyncStatus('error');
              saveToLocalStorage(); // Fallback
            }
          };

          const loadFromSheets = async () => {
            if (!spreadsheetId || !isAuthenticated) {
              loadFromLocalStorage();
              return;
            }

            try {
              setSyncStatus('syncing');

              const response = await gapi.client.sheets.spreadsheets.values.batchGet({
                spreadsheetId: spreadsheetId,
                ranges: ['Habits!A2:E', 'Tasks!A2:E', 'Progress!A2:G']
              });

              const [habitsData, tasksData, progressData] = response.result.valueRanges;

              // Load Habits
              if (habitsData.values) {
                const loadedHabits = habitsData.values.map(row => ({
                  id: row[0],
                  name: row[1],
                  description: row[2] || '',
                  completedDates: row[3] ? JSON.parse(row[3]) : {},
                  createdAt: row[4]
                }));
                setHabits(loadedHabits);
              }

              // Load Tasks
              if (tasksData.values) {
                const loadedTasks = tasksData.values.map(row => ({
                  id: row[0],
                  name: row[1],
                  description: row[2] || '',
                  completed: row[3] === 'TRUE',
                  createdAt: row[4]
                }));
                setTasks(loadedTasks);
              }

              // Load Progress
              if (progressData.values) {
                const loadedProgress = progressData.values.map(row => ({
                  id: row[0],
                  name: row[1],
                  description: row[2] || '',
                  current: parseFloat(row[3]) || 0,
                  target: parseFloat(row[4]) || 100,
                  unit: row[5] || '',
                  createdAt: row[6]
                }));
                setProgress(loadedProgress);
              }

              setSyncStatus('connected');
            } catch (error) {
              console.error('Error loading from sheets:', error);
              setSyncStatus('error');
              loadFromLocalStorage();
            }
          };

          const saveToLocalStorage = () => {
            localStorage.setItem('goalTracker_habits', JSON.stringify(habits));
            localStorage.setItem('goalTracker_tasks', JSON.stringify(tasks));
            localStorage.setItem('goalTracker_progress', JSON.stringify(progress));
          };

          const loadFromLocalStorage = () => {
            try {
              const savedHabits = localStorage.getItem('goalTracker_habits');
              const savedTasks = localStorage.getItem('goalTracker_tasks');
              const savedProgress = localStorage.getItem('goalTracker_progress');

              if (savedHabits) setHabits(JSON.parse(savedHabits));
              if (savedTasks) setTasks(JSON.parse(savedTasks));
              if (savedProgress) setProgress(JSON.parse(savedProgress));
            } catch (e) {
              console.error('Error loading from localStorage:', e);
            }
          };

          // Auto-save when data changes
          useEffect(() => {
            if (!isLoading) {
              saveToSheets();
            }
          }, [habits, tasks, progress]);

          // Utility Functions
          const generateId = () => `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
          const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
          const getMonthStart = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay();
          const formatMonthYear = (date) => date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
          const getDateKey = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;

          // Habit Functions
          const addHabit = () => {
            const newHabit = {
              id: generateId(),
              name: formData.name,
              description: formData.description,
              completedDates: {},
              createdAt: new Date().toISOString()
            };
            setHabits([...habits, newHabit]);
            closeModal();
          };

          const toggleHabitDay = (habitId, date) => {
            const dateKey = getDateKey(date);
            setHabits(habits.map(habit => {
              if (habit.id === habitId) {
                const newCompleted = { ...habit.completedDates };
                if (newCompleted[dateKey]) {
                  delete newCompleted[dateKey];
                } else {
                  newCompleted[dateKey] = true;
                }
                return { ...habit, completedDates: newCompleted };
              }
              return habit;
            }));
          };

          const getHabitStats = (habit, month) => {
            const daysInMonth = getDaysInMonth(month);
            const year = month.getFullYear();
            const monthNum = month.getMonth();
            let completed = 0;
            for (let day = 1; day <= daysInMonth; day++) {
              const date = new Date(year, monthNum, day);
              if (habit.completedDates[getDateKey(date)]) completed++;
            }
            return { completed, total: daysInMonth };
          };

          // Task Functions
          const addTask = () => {
            const newTask = {
              id: generateId(),
              name: formData.name,
              description: formData.description,
              completed: false,
              createdAt: new Date().toISOString()
            };
            setTasks([...tasks, newTask]);
            closeModal();
          };

          const toggleTask = (taskId) => {
            setTasks(tasks.map(task => 
              task.id === taskId ? { ...task, completed: !task.completed } : task
            ));
          };

          // Progress Functions
          const addProgress = () => {
            const newProgress = {
              id: generateId(),
              name: formData.name,
              description: formData.description,
              current: parseFloat(formData.current) || 0,
              target: parseFloat(formData.target) || 100,
              unit: formData.unit || '',
              createdAt: new Date().toISOString()
            };
            setProgress([...progress, newProgress]);
            closeModal();
          };

          const updateProgress = (progressId, newCurrent) => {
            setProgress(progress.map(p => 
              p.id === progressId ? { ...p, current: parseFloat(newCurrent) } : p
            ));
          };

          // Edit Functions
          const startEdit = (goal, type) => {
            setEditingGoal(goal);
            setModalType(type);
            setFormData({
              name: goal.name,
              description: goal.description || '',
              current: goal.current || 0,
              target: goal.target || 100,
              unit: goal.unit || ''
            });
            setShowEditModal(true);
          };

          const saveEdit = () => {
            if (modalType === 'habit') {
              setHabits(habits.map(h => 
                h.id === editingGoal.id ? { ...h, name: formData.name, description: formData.description } : h
              ));
            } else if (modalType === 'task') {
              setTasks(tasks.map(t => 
                t.id === editingGoal.id ? { ...t, name: formData.name, description: formData.description } : t
              ));
            } else if (modalType === 'progress') {
              setProgress(progress.map(p => 
                p.id === editingGoal.id ? { 
                  ...p, 
                  name: formData.name, 
                  description: formData.description,
                  target: parseFloat(formData.target) || 100,
                  unit: formData.unit || ''
                } : p
              ));
            }
            setShowEditModal(false);
            setEditingGoal(null);
          };

          // Delete Functions
          const deleteGoal = (id, type) => {
            if (!confirm('Are you sure you want to delete this goal?')) return;
            
            if (type === 'habit') setHabits(habits.filter(h => h.id !== id));
            else if (type === 'task') setTasks(tasks.filter(t => t.id !== id));
            else if (type === 'progress') setProgress(progress.filter(p => p.id !== id));
          };

          // Modal Functions
          const openAddModal = (type) => {
            setModalType(type);
            setFormData({ name: '', description: '', current: 0, target: 100, unit: '' });
            setShowAddModal(true);
          };

          const closeModal = () => {
            setShowAddModal(false);
            setShowEditModal(false);
            setEditingGoal(null);
          };

          const handleSubmit = (e) => {
            e.preventDefault();
            if (!formData.name.trim()) return;
            if (modalType === 'habit') addHabit();
            else if (modalType === 'task') addTask();
            else if (modalType === 'progress') addProgress();
          };

          // Navigation
          const previousMonth = () => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1));
          const nextMonth = () => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1));
          const goToToday = () => setCurrentMonth(new Date());

          // Auth Screen
          if (!isAuthenticated && !isLoading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl border-2 border-blue-200">
                  <div className="text-center mb-8">
                    <div className="bg-gradient-to-br from-blue-500 to-purple-500 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center text-5xl">
                      ðŸ’ª
                    </div>
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">Goal Tracker</h1>
                    <p className="text-gray-600">Track habits, tasks, and progress goals</p>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div className="flex items-start gap-3">
                      <Calendar size={24} className="text-blue-500 flex-shrink-0 mt-1" />
                      <div>
                        <h3 className="font-semibold text-gray-800">Daily Habits</h3>
                        <p className="text-sm text-gray-600">Track habits with a monthly calendar view</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <Check size={24} className="text-green-500 flex-shrink-0 mt-1" />
                      <div>
                        <h3 className="font-semibold text-gray-800">Task Checklist</h3>
                        <p className="text-sm text-gray-600">Simple checkboxes for your to-dos</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <TrendingUp size={24} className="text-purple-500 flex-shrink-0 mt-1" />
                      <div>
                        <h3 className="font-semibold text-gray-800">Progress Goals</h3>
                        <p className="text-sm text-gray-600">Track progress with visual bars</p>
                      </div>
                    </div>
                  </div>

                  <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-6">
                    <div className="flex items-start gap-2">
                      <Cloud size={20} className="text-blue-600 flex-shrink-0 mt-0.5" />
                      <div className="text-sm">
                        <p className="font-semibold text-blue-900 mb-1">Google Sheets Sync</p>
                        <p className="text-blue-700">Your data will be saved to Google Sheets and synced across all your devices.</p>
                      </div>
                    </div>
                  </div>

                  <button
                    onClick={handleAuthClick}
                    className="w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2"
                  >
                    <Cloud size={24} />
                    Connect Google Sheets
                  </button>

                  <p className="text-xs text-gray-500 text-center mt-4">
                    By connecting, you agree to create a new Google Sheet to store your goal data.
                  </p>
                </div>
              </div>
            );
          }

          // Loading Screen
          if (isLoading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center">
                <div className="text-center">
                  <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"></div>
                  <p className="text-gray-600 font-semibold">Loading your goals...</p>
                </div>
              </div>
            );
          }

          // Render Dashboard
          const renderDashboard = () => {
            const completedTasks = tasks.filter(t => t.completed).length;
            const totalHabitCompletions = habits.reduce((acc, habit) => {
              const stats = getHabitStats(habit, currentMonth);
              return acc + stats.completed;
            }, 0);
            const avgProgress = progress.length > 0 
              ? Math.round(progress.reduce((acc, p) => acc + (p.current / p.target * 100), 0) / progress.length)
              : 0;

            return (
              <div className="space-y-6">
                <div className="text-center mb-8">
                  <h1 className="text-4xl font-bold text-gray-800 mb-2">Goal Tracker</h1>
                  <p className="text-gray-600">Track your habits, tasks, and progress</p>
                  <div className={`inline-flex items-center gap-2 mt-3 px-4 py-2 rounded-full text-sm font-semibold ${
                    syncStatus === 'connected' ? 'bg-green-100 text-green-700' :
                    syncStatus === 'syncing' ? 'bg-blue-100 text-blue-700' :
                    'bg-gray-100 text-gray-700'
                  }`}>
                    <Cloud size={16} />
                    {syncStatus === 'connected' ? 'Synced' : syncStatus === 'syncing' ? 'Syncing...' : 'Offline'}
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border-2 border-blue-200">
                    <div className="flex items-center justify-between mb-4">
                      <Calendar size={32} className="text-blue-600" />
                      <span className="text-3xl font-bold text-blue-600">{habits.length}</span>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-800 mb-1">Habits</h3>
                    <p className="text-sm text-gray-600">{totalHabitCompletions} completions this month</p>
                  </div>

                  <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6 border-2 border-green-200">
                    <div className="flex items-center justify-between mb-4">
                      <Check size={32} className="text-green-600" />
                      <span className="text-3xl font-bold text-green-600">{completedTasks}/{tasks.length}</span>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-800 mb-1">Tasks</h3>
                    <p className="text-sm text-gray-600">{tasks.length > 0 ? Math.round(completedTasks / tasks.length * 100) : 0}% complete</p>
                  </div>

                  <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 border-2 border-purple-200">
                    <div className="flex items-center justify-between mb-4">
                      <TrendingUp size={32} className="text-purple-600" />
                      <span className="text-3xl font-bold text-purple-600">{avgProgress}%</span>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-800 mb-1">Progress Goals</h3>
                    <p className="text-sm text-gray-600">{progress.length} active goals</p>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                  <button onClick={() => setActiveTab('habits')} className="bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-4 font-semibold transition-all transform hover:scale-105">
                    View Habits â†’
                  </button>
                  <button onClick={() => setActiveTab('tasks')} className="bg-green-500 hover:bg-green-600 text-white rounded-xl p-4 font-semibold transition-all transform hover:scale-105">
                    View Tasks â†’
                  </button>
                  <button onClick={() => setActiveTab('progress')} className="bg-purple-500 hover:bg-purple-600 text-white rounded-xl p-4 font-semibold transition-all transform hover:scale-105">
                    View Progress â†’
                  </button>
                </div>
              </div>
            );
          };

          // Render Calendar (simplified for space)
          const renderCalendar = (habit) => {
            const daysInMonth = getDaysInMonth(currentMonth);
            const monthStart = getMonthStart(currentMonth);
            const days = [];
            const stats = getHabitStats(habit, currentMonth);

            for (let i = 0; i < monthStart; i++) {
              days.push(<div key={`empty-${i}`} className="aspect-square" />);
            }

            for (let day = 1; day <= daysInMonth; day++) {
              const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
              const dateKey = getDateKey(date);
              const isCompleted = habit.completedDates[dateKey];
              const isToday = new Date().toDateString() === date.toDateString();

              days.push(
                <button
                  key={day}
                  onClick={() => toggleHabitDay(habit.id, date)}
                  className={`aspect-square rounded-lg flex items-center justify-center text-sm font-semibold transition-all transform hover:scale-110 ${
                    isCompleted ? 'bg-blue-500 text-white shadow-lg' :
                    isToday ? 'bg-blue-100 text-blue-600 border-2 border-blue-500' :
                    'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {day}
                </button>
              );
            }

            return (
              <div className="bg-white rounded-xl p-6 shadow-lg border-2 border-blue-200 mb-4">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-gray-800">{habit.name}</h3>
                    {habit.description && <p className="text-sm text-gray-600 mt-1">{habit.description}</p>}
                  </div>
                  <div className="flex gap-2">
                    <button onClick={() => startEdit(habit, 'habit')} className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                      <Edit2 size={18} />
                    </button>
                    <button onClick={() => deleteGoal(habit.id, 'habit')} className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                      <Trash2 size={18} />
                    </button>
                  </div>
                </div>

                <div className="mb-4">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-2xl font-bold text-blue-600">{stats.completed}/{stats.total}</span>
                    <span className="text-sm text-gray-600">{Math.round(stats.completed / stats.total * 100)}% complete</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div className="bg-blue-500 h-3 rounded-full transition-all duration-300" style={{ width: `${stats.completed / stats.total * 100}%` }} />
                  </div>
                </div>

                <div className="grid grid-cols-7 gap-2">
                  {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                    <div key={day} className="text-center text-xs font-semibold text-gray-600 py-2">{day}</div>
                  ))}
                  {days}
                </div>
              </div>
            );
          };

          // Render Habits
          const renderHabits = () => (
            <div className="space-y-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-3xl font-bold text-gray-800">Habit Tracker</h2>
                <button onClick={() => openAddModal('habit')} className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 transition-all transform hover:scale-105">
                  <Plus size={20} />Add Habit
                </button>
              </div>

              <div className="flex items-center justify-center gap-4 mb-6">
                <button onClick={previousMonth} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                  <ChevronLeft size={24} />
                </button>
                <h3 className="text-xl font-semibold text-gray-800 min-w-[200px] text-center">
                  {formatMonthYear(currentMonth)}
                </h3>
                <button onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                  <ChevronRight size={24} />
                </button>
                {currentMonth.getMonth() !== new Date().getMonth() && (
                  <button onClick={goToToday} className="ml-4 px-4 py-2 bg-blue-100 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-200 transition-colors">
                    Today
                  </button>
                )}
              </div>

              {habits.length === 0 ? (
                <div className="text-center py-16">
                  <Calendar size={64} className="mx-auto text-gray-400 mb-4" />
                  <p className="text-gray-600 text-lg mb-4">No habits yet. Start tracking today!</p>
                  <button onClick={() => openAddModal('habit')} className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold">
                    Add Your First Habit
                  </button>
                </div>
              ) : (
                habits.map(habit => renderCalendar(habit))
              )}
            </div>
          );

          // Render Tasks (simplified)
          const renderTasks = () => (
            <div className="space-y-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-3xl font-bold text-gray-800">Task Checklist</h2>
                <button onClick={() => openAddModal('task')} className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 transition-all transform hover:scale-105">
                  <Plus size={20} />Add Task
                </button>
              </div>

              {tasks.length === 0 ? (
                <div className="text-center py-16">
                  <Check size={64} className="mx-auto text-gray-400 mb-4" />
                  <p className="text-gray-600 text-lg mb-4">No tasks yet. Add your first task!</p>
                  <button onClick={() => openAddModal('task')} className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-semibold">
                    Add Your First Task
                  </button>
                </div>
              ) : (
                <div className="space-y-3">
                  {tasks.map(task => (
                    <div key={task.id} className={`bg-white rounded-xl p-6 shadow-lg border-2 transition-all ${task.completed ? 'border-green-300 bg-green-50' : 'border-green-200'}`}>
                      <div className="flex items-start gap-4">
                        <button onClick={() => toggleTask(task.id)} className={`flex-shrink-0 w-8 h-8 rounded-lg border-2 flex items-center justify-center transition-all ${task.completed ? 'bg-green-500 border-green-500' : 'border-gray-300 hover:border-green-500'}`}>
                          {task.completed && <Check size={20} className="text-white" />}
                        </button>
                        <div className="flex-1">
                          <h3 className={`text-lg font-semibold ${task.completed ? 'text-gray-500 line-through' : 'text-gray-800'}`}>{task.name}</h3>
                          {task.description && <p className={`text-sm mt-1 ${task.completed ? 'text-gray-400' : 'text-gray-600'}`}>{task.description}</p>}
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => startEdit(task, 'task')} className="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors">
                            <Edit2 size={18} />
                          </button>
                          <button onClick={() => deleteGoal(task.id, 'task')} className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          );

          // Render Progress (simplified)
          const renderProgress = () => (
            <div className="space-y-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-3xl font-bold text-gray-800">Progress Goals</h2>
                <button onClick={() => openAddModal('progress')} className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 transition-all transform hover:scale-105">
                  <Plus size={20} />Add Goal
                </button>
              </div>

              {progress.length === 0 ? (
                <div className="text-center py-16">
                  <TrendingUp size={64} className="mx-auto text-gray-400 mb-4" />
                  <p className="text-gray-600 text-lg mb-4">No progress goals yet. Start tracking!</p>
                  <button onClick={() => openAddModal('progress')} className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold">
                    Add Your First Goal
                  </button>
                </div>
              ) : (
                <div className="space-y-4">
                  {progress.map(p => {
                    const percentage = Math.min(Math.round(p.current / p.target * 100), 100);
                    return (
                      <div key={p.id} className="bg-white rounded-xl p-6 shadow-lg border-2 border-purple-200">
                        <div className="flex items-start justify-between mb-4">
                          <div className="flex-1">
                            <h3 className="text-xl font-bold text-gray-800">{p.name}</h3>
                            {p.description && <p className="text-sm text-gray-600 mt-1">{p.description}</p>}
                          </div>
                          <div className="flex gap-2">
                            <button onClick={() => startEdit(p, 'progress')} className="p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors">
                              <Edit2 size={18} />
                            </button>
                            <button onClick={() => deleteGoal(p.id, 'progress')} className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </div>

                        <div className="mb-4">
                          <div className="flex justify-between items-baseline mb-2">
                            <span className="text-3xl font-bold text-purple-600">{p.current} {p.unit}</span>
                            <span className="text-gray-600">of {p.target} {p.unit}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-4">
                            <div className="bg-purple-500 h-4 rounded-full transition-all duration-300 flex items-center justify-end pr-2" style={{ width: `${percentage}%` }}>
                              {percentage > 15 && <span className="text-white text-xs font-bold">{percentage}%</span>}
                            </div>
                          </div>
                          {percentage <= 15 && <div className="text-right mt-1"><span className="text-sm font-semibold text-purple-600">{percentage}%</span></div>}
                        </div>

                        <div className="flex gap-2">
                          <input type="number" value={p.current} onChange={(e) => updateProgress(p.id, e.target.value)} className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" min="0" max={p.target} step="0.1" />
                          <button onClick={() => updateProgress(p.id, Math.min(p.current + 1, p.target))} className="px-6 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                            +1
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          );

          // Render Modal
          const renderModal = (isEdit = false) => {
            const show = isEdit ? showEditModal : showAddModal;
            if (!show) return null;

            const title = isEdit ? 'Edit ' : 'Add New ';
            const typeLabel = modalType === 'habit' ? 'Habit' : modalType === 'task' ? 'Task' : 'Progress Goal';

            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                  <div className="flex items-center justify-between mb-6">
                    <h3 className="text-2xl font-bold text-gray-800">{title}{typeLabel}</h3>
                    <button onClick={closeModal} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                      <X size={24} />
                    </button>
                  </div>

                  <form onSubmit={isEdit ? (e) => { e.preventDefault(); saveEdit(); } : handleSubmit} className="space-y-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Name *</label>
                      <input type="text" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="e.g., Morning Exercise, Read a Book" required />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Description (optional)</label>
                      <textarea value={formData.description} onChange={(e) => setFormData({ ...formData, description: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none" rows="3" placeholder="Additional details..." />
                    </div>

                    {modalType === 'progress' && (
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">Target *</label>
                          <input type="number" value={formData.target} onChange={(e) => setFormData({ ...formData, target: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" min="1" step="0.1" required />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">Unit</label>
                          <input type="text" value={formData.unit} onChange={(e) => setFormData({ ...formData, unit: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="pages, km, etc." />
                        </div>
                      </div>
                    )}

                    <div className="flex gap-3 pt-4">
                      <button type="button" onClick={closeModal} className="flex-1 px-6 py-3 bg-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                        Cancel
                      </button>
                      <button type="submit" className={`flex-1 px-6 py-3 text-white rounded-xl font-semibold transition-colors ${
                        modalType === 'habit' ? 'bg-blue-500 hover:bg-blue-600' :
                        modalType === 'task' ? 'bg-green-500 hover:bg-green-600' :
                        'bg-purple-500 hover:bg-purple-600'
                      }`}>
                        {isEdit ? 'Save Changes' : 'Add Goal'}
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            );
          };

          // Main Render
          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4 md:p-8">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-2xl shadow-lg p-2 mb-8 flex flex-wrap gap-2">
                  <button onClick={() => setActiveTab('dashboard')} className={`flex-1 min-w-[120px] px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'dashboard' ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg' : 'text-gray-600 hover:bg-gray-100'
                  }`}>
                    <Target className="inline mr-2" size={20} />Dashboard
                  </button>
                  <button onClick={() => setActiveTab('habits')} className={`flex-1 min-w-[120px] px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'habits' ? 'bg-blue-500 text-white shadow-lg' : 'text-gray-600 hover:bg-gray-100'
                  }`}>
                    <Calendar className="inline mr-2" size={20} />Habits
                  </button>
                  <button onClick={() => setActiveTab('tasks')} className={`flex-1 min-w-[120px] px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'tasks' ? 'bg-green-500 text-white shadow-lg' : 'text-gray-600 hover:bg-gray-100'
                  }`}>
                    <Check className="inline mr-2" size={20} />Tasks
                  </button>
                  <button onClick={() => setActiveTab('progress')} className={`flex-1 min-w-[120px] px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'progress' ? 'bg-purple-500 text-white shadow-lg' : 'text-gray-600 hover:bg-gray-100'
                  }`}>
                    <TrendingUp className="inline mr-2" size={20} />Progress
                  </button>
                </div>

                {activeTab === 'dashboard' && renderDashboard()}
                {activeTab === 'habits' && renderHabits()}
                {activeTab === 'tasks' && renderTasks()}
                {activeTab === 'progress' && renderProgress()}

                {renderModal(false)}
                {renderModal(true)}
                
                {/* Version Info */}
                <div className="text-center mt-8 pb-4">
                  <p className="text-gray-400 text-xs font-medium">
                    Goal Tracker v2.0 - Google Sheets Sync
                  </p>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<GoalTrackerApp />, document.getElementById('root'));
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
              .then(reg => console.log('Service Worker registered'))
              .catch(err => console.log('Service Worker registration failed'));
          });
        }
    </script>
</body>
</html>
